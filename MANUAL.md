# 会員管理システム 取扱説明書

## 1. はじめに

このドキュメントは、Google Apps Script（GAS）で構築された会員管理システムの取り扱いについて説明します。
このシステムは、Googleスプレッドシートをデータベースとして利用し、Webアプリケーションとして動作します。

**対象読者**
*   **システム管理者**: システムのセットアップと全体管理を行う方。
*   **一般利用者（会員）**: システムに会員登録し、自身の情報を管理する方。

---

## 2. システムの初期設定（管理者向け）

本システムを利用するためには、初めにGoogleスプレッドシートとGoogle Apps Scriptプロジェクトのセットアップが必要です。

### 手順1: Google Apps Scriptプロジェクトの準備

1.  このプロジェクトをGoogle Driveにコピーし、Google Apps Scriptエディタで開きます。
2.  `appsscript.json`ファイルに記載されているタイムゾーンやライブラリが、ご利用の環境に合わせて適切に設定されていることを確認してください。

### 手順2: データベース（スプレッドシート）の初期化

1.  Apps Scriptエディタの上部にある関数選択メニューから `initializeSheets` を選択します。
2.  `▶ 実行` ボタンをクリックします。
3.  初回実行時には、スクリプトがあなたのGoogleアカウントデータにアクセスするための承認を求められます。画面の指示に従い、許可してください。
4.  実行が完了すると、このスクリプトに紐づいたGoogleスプレッドシート内に、以下のシートが自動的に作成されます。
    *   `[マスタ]メンバー`
    *   `[マスタ]設定`
    *   `[マスタ]フォーム項目`
    *   `[マスタ]メールテンプレート`
    *   `[ログ]AdminActionLog`
    *   `[ログ]MemberChangeLog`
    *   `[ログ]ErrorLog`
    *   `[ログ]MailLog`
    *   `[ログ]TemplateChangeLog`
    *   `[データ]Tokens`
    *   `[データ]MailRetry`

### 手順3: Webアプリケーションとしてデプロイ

1.  Apps Scriptエディタの右上にある `デプロイ` ボタンをクリックし、「新しいデプロイ」を選択します。
2.  「種類の選択」で歯車アイコンをクリックし、「ウェブアプリ」を選択します。
3.  以下の設定を行います。
    *   **説明**: （任意）デプロイの説明を入力します。
    *   **ウェブアプリ**:
        *   **次のユーザーとして実行**: `自分`
        *   **アクセスできるユーザー**: `全員` （会員登録ページを一般公開する場合）
4.  `デプロイ` ボタンをクリックします。
5.  表示された**ウェブアプリのURL**が、このシステムのベースURLとなります。このURLを関係者に共有してください。

---

## 3. 管理者向け操作マニュアル

管理者の主な作業は、Googleスプレッドシート上のデータを直接編集することと、Webダッシュボードを操作することに分かれます。

### 3.1. Googleスプレッドシートでの管理

#### `[マスタ]設定` シート
システムの基本的な動作を管理します。`key`列に対応する`value`列を編集してください。
*   `appName`: アプリケーション名。メールの件名などで使用されます。
*   `adminEmails`: 管理者として認識されるメールアドレス。カンマ区切りで複数指定可能です。ここに登録されたGoogleアカウントのユーザーは、管理ダッシュボードにアクセスできます。
*   その他、システム動作に関わる各種設定。

#### `[マスタ]フォーム項目` シート
会員登録・更新フォームに表示される入力項目を定義します。
*   行を追加・削除することで、フォームの項目を自由に増減できます。
*   `type`列で、`text` `email` `textarea` などの入力タイプを指定できます。
*   `isRequired`列で、必須項目かどうか（`TRUE` / `FALSE`）を設定します。

#### `[マスタ]メールテンプレート` シート
会員への通知メールの内容を管理します。
*   `key`列でメールの種類（例: `registration` `update`）を識別します。
*   `subject`（件名）と`body`（本文）を編集できます。
*   本文中では `${...}` という形式で変数（例: `${name}` `${memberId}`）を使用できます。変数は`[マスタ]フォーム項目`シートの`id`列に対応しています。

### 3.2. Webダッシュボードでの管理

ウェブアプリのURLにGoogleアカウントでログインした状態でアクセスします。メールアドレスが`[マスタ]設定`シートの`adminEmails`に含まれている場合、管理者ダッシュボードが表示されます。

*   **会員管理**: 登録されている会員の一覧を検索・閲覧できます。
*   **各種ログ**: エラー発生状況、メール送信履歴、管理者操作履歴などを時系列で確認できます。
*   **メール再送**: 何らかの理由で送信に失敗したメールを手動で再送できます。

---

## 4. 会員向け操作マニュアル

### 4.1. 新規会員登録

1.  WebアプリのURLにアクセスすると、登録ページが表示されます。
    *   URL例: `https://script.google.com/macros/s/xxxxxxxx/exec?page=register`
2.  フォームの項目を入力し、「確認する」ボタンを押すと、仮登録が完了します。
3.  入力したメールアドレス宛に、本登録用の案内メールが届きます。
4.  メール本文に記載されているURLをクリックすると、本登録が完了し、会員番号が画面に表示されます。

### 4.2. 登録情報の更新

1.  情報更新ページにアクセスします。
    *   URL例: `https://script.google.com/macros/s/xxxxxxxx/exec?page=update`
2.  本人確認のため、登録済みのメールアドレスと会員番号を入力します。
3.  認証が成功すると、現在の登録情報が入力されたフォームが表示されます。
4.  内容を修正して更新ボタンを押すと、手続きは完了です。完了通知メールが届きます。

---

## 5. 付録

### トラブルシューティング

*   **メールが届かない**:
    *   入力したメールアドレスが正しいか確認してください。
    *   迷惑メールフォルダに振り分けられていないか確認してください。
    *   （管理者向け）`[ログ]MailLog`シートおよび`[ログ]ErrorLog`シートにエラーが記録されていないか確認してください。

*   **管理ダッシュボードにアクセスできない**:
    *   現在ログインしているGoogleアカウントのメールアドレスが、`[マスタ]設定`シートの`adminEmails`キーに正しく登録されているか確認してください。
